{
  "pluginAlias": "ZipaboxPlatform-dev",
  "pluginType": "platform",
  "singular": false,
  "headerDisplay": "Please read the [README.md](https://github.com/GusMuche/homebridge-zipabox-platform/blob/master/README.md) to understand all the parameters",
  "footerDisplay": "For help please see the [gihub page](https://github.com/GusMuche/homebridge-zipabox-platform).",
  "schema": {
    "username": {
      "title": "Login on my.zipato.com",
      "type": "string",
      "pattern": "^\\S+@\\S+$",
      "required": true
    },
    "password":{
      "title": "Password on my.zipato.com",
      "type": "string",
      "required": true
    },
    "connection":{
        "type":"object",
        "properties":{
            "local" :{
                "title" : "Local API",
                "type": "boolean",
                "default":false
            },
            "server_ip": {
                  "title": "Local IP",
                  "type": "string",
                  "condition": {"functionBody": "return model.connection.local === true;"},
                  "description": "Local : only IP (no http or port)"
            },
            "api_version": {
                "title": "API version",
                "type": "string",
                "oneOf":[
                  {"title":"my.zipato.com", "enum": ["remoteV2"] },
                  {"title":"my3.zipato.com", "enum": ["remoteV3"] }
                ],
                "condition": {"functionBody": "return model.connection.local === false;"}
            }
        },
        "dependencies": {
            "server_ip": { "required": ["localCheck"] },
            "api_version": { "required": ["!localCheck"] }
        }
    },
    "boxSerial": {
      "title": "Box Serial",
      "type": "string",
      "required": false,
      "description": "The box serial to select.",
      "condition": {"functionBody": "return model.connection.api_version === 'remoteV3';"}
    },
    "pin": {
      "title": "PIN code for alarm",
      "type": "string",
      "required": false,
      "description": "Needed if you have one alarm accessory"
    },
    "refresh": {
      "title": "Refresh rate",
      "type": "integer",
      "required": false,
      "description": "Time in seconds to refresh ALL the accessories.",
      "default": 10,
      "minimum": 0,
      "exclusiveMinimum": false,
      "maximum": 600
    },
    "debug": {
      "title": "Debug platform",
      "type": "boolean",
      "required": false
    },
    "debugApi": {
      "title": "Debug API request",
      "type": "boolean",
      "required": false
    },
    "accessories": {
      "title": "Accessories to request on the Box",
      "type": "array",
      "items": {
        "name": "Accessory",
        "type": "object",
        "properties":{
          "name" :{
            "title":"Name",
            "type" : "string",
            "description": "Can be changed in Home App",
            "required": true
          },
          "batteryLimit":{
            "title":"Battery limit",
            "type" : "integer",
            "description": "Battery percents before warning",
            "required": false,
            "minimum": 0,
            "exclusiveMinimum": false,
            "maximum": 100
          },
          "noStatus":{
            "title":"No Status available",
            "type" : "boolean",
            "required": false
          },
          "useEve":{
            "title":"Use Eve info",
            "type" : "boolean",
            "required": false
          },
          "debug":{
            "title":"Debug Mode",
            "type" : "boolean",
            "required": false
          },
          "hidden":{
            "title": "Hide",
            "type" : "boolean",
            "required": false
          },
          "manufacturer":{
            "title":"Manufacturer",
            "type" : "string",
            "required": false
          },
          "model":{
            "title":"Model",
            "type" : "string",
            "required": false
          },
          "serial":{
            "title": "serial",
            "type" : "string",
            "required": false
          },
          "services":{
              "title": "Services for this accessory",
              "type": "array",
              "items":{
                  "name": "Services",
                  "type" : "object",
                  "properties":{
                      "uuid":{
                        "title":"uuid",
                        "type" : "string",
                        "description": "UUID of the state. Lowest level in my.zipato.com (see readme)",
                        "required": true
                      },
                      "type":{
                        "title": "Type of accessory",
                        "type": "string",
                        "default": "switch",
                        "oneOf":[
                          {"title":"switch", "enum": ["switch"] },
                          {"title":"light", "enum": ["light"] },
                          {"title":"outlet", "enum": ["outlet"] },
                          {"title":"temperature", "enum": ["temperature"] },
                          {"title":"ambient", "enum": ["ambient"] },
                          {"title":"motion", "enum": ["motion"] },
                          {"title":"contact", "enum": ["contact"] },
                          {"title":"window", "enum": ["window"] },
                          {"title":"door", "enum": ["door"] },
                          {"title":"covering", "enum": ["covering"] },
                          {"title":"leak", "enum": ["leak"] },
                          {"title":"battery", "enum": ["battery"] },
                          {"title":"co2", "enum": ["co2"] },
                          {"title":"alarm", "enum": ["alarm"] } ],
                        "required": true
                      },
                      "uuidb":{
                        "title":"uuidb",
                        "type" : "string",
                        "description": "Only for some accessories (see Readme)",
                        "required": false,
                        "condition": {"functionBody": "return model.accessories[].services[].type === 'battery';"}
                      },
                      "nightMode":{
                        "title": "Night in place of Home",
                        "type" : "boolean",
                        "required": false
                      },
                      "reverse":{
                        "title": "Reverse the signal",
                        "type" : "boolean",
                        "required": false
                      },
                      "min":{
                        "title":"Min value",
                        "type" : "integer",
                        "description": "Minimum value to adapt the scale",
                        "required": false
                      },
                      "max":{
                        "title":"Max value",
                        "type" : "integer",
                        "description": "Maximum value to adapt the scale",
                        "required": false
                      }
                  }
              }
          }
        }
      }
    }
  },
  "form": [
    {
      "type": "fieldset",
      "title": "Box",
      "expandable": true,
      "expanded": true,
      "items": [
        { "type": "flex", "flex-flow": "row wrap","items": [
            "username",
            {"key":"password","type":"password"}
        ]},
        { "type": "flex", "flex-flow": "row wrap","items": [
            "connection.local",
            "connection.server_ip",
            "connection.api_version"
        ]},
        "boxSerial",
        { "type": "flex", "flex-flow": "row wrap","items": [
            {"key":"pin","type":"password"},
            "refresh"
        ]},
        { "type": "flex", "flex-flow": "row wrap", "items": [ "debug","debugApi"]}
      ]
    },
    {
      "type":"tabarray",
      "key":"accessories",
      "tabType": "left",
      "title": "{{idx}}.{{value.name}}",
      "add": "New Accessory",
      "items":[
        {
          "legend": "{{idx}}.{{value.name}}",
          "items": [
            "accessories[].name",
            {"type": "fieldset",
                "title": "Device optional parameters",
                "expandable": true,
                "expanded": false,
                "items": [
                    {"type": "flex", "flex-flow": "row wrap", "items": [ "accessories[].manufacturer","accessories[].model","accessories[].serial"]},
                    "accessories[].batteryLimit",
                    {"type": "flex", "flex-flow": "row wrap", "items": [ "accessories[].noStatus","accessories[].debug","accessories[].useEve","accessories[].hidden"]}
                ]
            },
            {
                "type":"array",
                "key": "accessories[].services",
                "add": "Add one service",
                "title":"Services for this accessory",
                "style": { "add": "btn-success" },
                "items": [
                    {
                        "items":[
                            {"type": "flex", "flex-flow": "row wrap", "items": [ "accessories[].services[].uuid","accessories[].services[].type"]},
                            {"type": "flex", "flex-flow": "row wrap", "items": [ "accessories[].services[].uuidb"]},
                            {"type": "fieldset",
                            "title": "Service optional parameters",
                            "expandable": true,
                            "expanded": false,
                            "items": [
                            {"type": "flex", "flex-flow": "row wrap", "items": [ "accessories[].services[].nightMode","accessories[].services[].reverse"]},
                            {"type": "flex", "flex-flow": "row wrap", "items": [ "accessories[].services[].min","accessories[].services[].max"]}
                            ]}
                        ]
                    }
                ]
            }
          ]
        }

      ]
    }
  ]
}
